<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8" />
  <title>Ruleta de la suerte Clínica Estética Vitabella</title>
  <style>
    body {
      font-family: Arial, sans-serif;
      background: #00A9A5; /* Color de fondo solicitado */
      margin: 0;
      padding: 20px;
      display: flex;
      flex-direction: column;
      align-items: center;
    }

    h1, h2 {
      text-align: center;
      margin: 10px 0;
      color: #fff; /* Se puede dejar en blanco para contrastar con el nuevo fondo */
    }

    /* Estilos del formulario */
    form {
      background: #fff;
      padding: 20px;
      border-radius: 8px;
      max-width: 400px;
      width: 100%;
      box-shadow: 0 0 10px rgba(0,0,0,0.1);
      margin-bottom: 20px;
    }

    form label {
      display: block;
      margin-bottom: 5px;
      font-weight: bold;
    }

    form input[type="text"],
    form input[type="email"] {
      width: 100%;
      padding: 8px;
      margin-bottom: 15px;
      border: 1px solid #ccc;
      border-radius: 4px;
      box-sizing: border-box;
    }

    form button {
      display: inline-block;
      padding: 10px 20px;
      font-size: 1rem;
      background-color: #2196F3;
      color: #fff;
      border: none;
      border-radius: 4px;
      cursor: pointer;
    }

    form button:hover {
      background-color: #1976D2;
    }

    /* Mensaje de error */
    .error-message {
      color: red;
      margin-bottom: 10px;
      font-weight: bold;
    }

    /* Contenedor de la ruleta */
    .wheel-container {
      position: relative;
      width: 400px;
      height: 400px;
      margin: 20px auto;
    }

    /* Ruleta */
    .wheel {
      width: 100%;
      height: 100%;
      border-radius: 50%;
      position: relative;
      overflow: hidden;
      transition: transform 4s cubic-bezier(0.25, 0.1, 0.25, 1);
    }

    /* Flecha indicadora */
    .pointer {
      position: absolute;
      top: -20px;
      left: 50%;
      transform: translateX(-50%);
      width: 0;
      height: 0;
      border-left: 20px solid transparent;
      border-right: 20px solid transparent;
      border-bottom: 40px solid #333;
      z-index: 10;
    }

    /* Botón para girar la ruleta */
    .spin-button {
      margin-top: 20px;
      padding: 10px 20px;
      font-size: 1.1rem;
      background-color: #2196F3;
      color: #fff;
      border: none;
      border-radius: 4px;
      cursor: pointer;
      display: none; /* Oculto hasta que se validen datos */
    }
    .spin-button:hover {
      background-color: #1976D2;
    }

    /* Mensaje de resultado */
    #result-message {
      margin-top: 20px;
      font-size: 1.2rem;
      font-weight: bold;
      text-align: center;
      min-height: 40px;
      color: #fff; /* Texto en blanco para contrastar */
    }

    /* Secciones de la ruleta (colores) */
    .wheel::before {
      content: '';
      position: absolute;
      width: 200%;
      height: 200%;
      top: -50%;
      left: -50%;
      background: conic-gradient(
        #ff5555 0deg 45deg,    /* 10% OFF */
        #ffa500 45deg 90deg,  /* 15% OFF */
        #ffdd55 90deg 135deg, /* 20% OFF */
        #82E0AA 135deg 180deg,/* 25% OFF */
        #5DADE2 180deg 225deg,/* 30% OFF */
        #AF7AC5 225deg 270deg,/* 35% OFF */
        #F1948A 270deg 315deg,/* 40% OFF */
        #808B96 315deg 360deg /* 50% OFF */
      );
    }

    /* Texto visible en la ruleta para cada premio */
    .discount-label {
      position: absolute;
      top: 50%;
      left: 50%;
      transform-origin: 0 0;
      font-weight: bold;
      color: #fff;
      text-shadow: 1px 1px 2px #333;
      font-size: 1rem;
    }

    /* Contenedor del código y botón para copiar */
    .code-container {
      margin-top: 20px;
      display: none; /* Se muestra al obtener un premio */
      text-align: center;
    }
    .code {
      background: #eee;
      padding: 10px;
      border-radius: 4px;
      font-weight: bold;
      display: inline-block;
      margin-right: 10px;
    }
    .copy-button {
      padding: 8px 16px;
      font-size: 1rem;
      background-color: #4CAF50;
      color: #fff;
      border: none;
      border-radius: 4px;
      cursor: pointer;
    }
    .copy-button:hover {
      background-color: #388E3C;
    }
  </style>
</head>
<body>
  <h1>Ruleta de la suerte Clínica Estética Vitabella</h1>

  <!-- FORMULARIO DE DATOS -->
  <form id="userForm">
    <div id="errorMsg" class="error-message"></div>

    <label for="nombre">Nombre y Apellido:</label>
    <input type="text" id="nombre" name="nombre" placeholder="Ej: Juan Pérez" />

    <label for="rut">RUT (Chile):</label>
    <input type="text" id="rut" name="rut" placeholder="Ej: 12.345.678-9" />

    <label for="email">Correo electrónico:</label>
    <input type="email" id="email" name="email" placeholder="ejemplo@correo.com" />

    <label for="boleta">Nº de boleta:</label>
    <input type="text" id="boleta" name="boleta" placeholder="Ej: 123456789" />

    <button type="button" id="validateButton">Validar Datos</button>
  </form>

  <!-- RULETA -->
  <div class="wheel-container">
    <div class="pointer"></div>
    <div class="wheel" id="wheel">
      <!-- 8 etiquetas para cada tramo de la ruleta (texto centrado en cada sección) -->
      <div class="discount-label" style="transform: rotate(22.5deg) translate(130px) rotate(-22.5deg)">10% OFF</div>
      <div class="discount-label" style="transform: rotate(67.5deg) translate(130px) rotate(-67.5deg)">15% OFF</div>
      <div class="discount-label" style="transform: rotate(112.5deg) translate(130px) rotate(-112.5deg)">20% OFF</div>
      <div class="discount-label" style="transform: rotate(157.5deg) translate(130px) rotate(-157.5deg)">25% OFF</div>
      <div class="discount-label" style="transform: rotate(202.5deg) translate(130px) rotate(-202.5deg)">30% OFF</div>
      <div class="discount-label" style="transform: rotate(247.5deg) translate(130px) rotate(-247.5deg)">35% OFF</div>
      <div class="discount-label" style="transform: rotate(292.5deg) translate(130px) rotate(-292.5deg)">40% OFF</div>
      <div class="discount-label" style="transform: rotate(337.5deg) translate(130px) rotate(-337.5deg)">50% OFF</div>
    </div>
  </div>

  <!-- BOTÓN PARA GIRAR (inicialmente oculto) -->
  <button class="spin-button" id="spinButton">Girar Ruleta</button>

  <div id="result-message"></div>

  <!-- CÓDIGO DE CUPÓN -->
  <div class="code-container" id="codeContainer">
    <span class="code" id="couponCode"></span>
    <button class="copy-button" id="copyButton">Copiar código</button>
  </div>

  <script>
    // -----------------------------------------------------
    //   SECCIÓN DEL FORMULARIO Y VALIDACIÓN DE DATOS
    // -----------------------------------------------------
    const userForm = document.getElementById("userForm");
    const validateButton = document.getElementById("validateButton");
    const errorMsg = document.getElementById("errorMsg");

    const nombreInput = document.getElementById("nombre");
    const rutInput = document.getElementById("rut");
    const emailInput = document.getElementById("email");
    const boletaInput = document.getElementById("boleta");

    const spinButton = document.getElementById("spinButton");

    // Evento de validación
    validateButton.addEventListener("click", () => {
      // Limpiamos mensajes anteriores
      errorMsg.textContent = "";

      // Capturamos valores
      const nombreVal = nombreInput.value.trim();
      const rutVal = rutInput.value.trim();
      const emailVal = emailInput.value.trim();
      const boletaVal = boletaInput.value.trim();

      // Validaciones básicas
      if (!nombreVal || !rutVal || !emailVal || !boletaVal) {
        errorMsg.textContent = "Por favor, completa todos los campos.";
        return;
      }

      if (!validateEmail(emailVal)) {
        errorMsg.textContent = "El correo electrónico no es válido.";
        return;
      }

      if (!validateRUT(rutVal)) {
        errorMsg.textContent = "El RUT ingresado no es válido.";
        return;
      }

      // Si todas las validaciones son correctas, habilitamos el botón de la ruleta
      spinButton.style.display = "inline-block";  // Mostramos el botón
      errorMsg.textContent = "";
      alert("Datos válidos. ¡Ahora puedes girar la ruleta!");
    });

    // Función para validar email (básica)
    function validateEmail(email) {
      const re = /^[^\s@]+@[^\s@]+\.[^\s@]+$/;
      return re.test(email);
    }

    // Función para validar RUT Chileno
    function validateRUT(rut) {
      // 1. Limpiar el RUT de puntos y guiones
      const cleanRut = rut.replace(/[.-]/g, "").toUpperCase();

      // Debe tener mínimo 2 caracteres (1 dígito + dígito verificador)
      if (cleanRut.length < 2) return false;

      const body = cleanRut.slice(0, -1);
      let dv = cleanRut.slice(-1);

      // Validar que el body sea numérico
      if (!/^\d+$/.test(body)) return false;

      // "K" es un dígito verificador válido que equivale a 10
      if (dv === "K") dv = "10";
      else if (dv === "0") dv = "11";

      dv = parseInt(dv, 10);

      // Calcular el dígito verificador
      let sum = 0;
      let multiplier = 2;

      for (let i = body.length - 1; i >= 0; i--) {
        sum += parseInt(body[i]) * multiplier;
        multiplier = (multiplier < 7) ? multiplier + 1 : 2;
      }

      const expectedDV = 11 - (sum % 11);
      return (expectedDV === dv);
    }

    // -----------------------------------------------------
    //   SECCIÓN DE LA RULETA
    // -----------------------------------------------------

    const wheel = document.getElementById("wheel");
    const resultMessage = document.getElementById("result-message");
    const codeContainer = document.getElementById("codeContainer");
    const couponCodeSpan = document.getElementById("couponCode");
    const copyButton = document.getElementById("copyButton");

    const discounts = [
      "10% OFF",
      "15% OFF",
      "20% OFF",
      "25% OFF",
      "30% OFF",
      "35% OFF",
      "40% OFF",
      "50% OFF"
    ];

    let isSpinning = false;

    spinButton.addEventListener("click", () => {
      if (isSpinning) return; // Evita múltiples giros simultáneos

      isSpinning = true;
      resultMessage.textContent = "";
      codeContainer.style.display = "none";

      // Número aleatorio de vueltas entre 5 y 10
      const spins = Math.floor(Math.random() * 6) + 5;
      // Determina la sección ganadora
      const randomDiscountIndex = Math.floor(Math.random() * discounts.length);

      // Cada sección son 45°, con un offset de 22.5° para centrar la flecha.
      const baseAngle = 22.5 + (45 * randomDiscountIndex);
      const totalAngle = (360 * spins) + baseAngle;

      wheel.style.transition = "transform 4s cubic-bezier(0.25, 0.1, 0.25, 1)";
      wheel.style.transform = `rotate(${totalAngle}deg)`;

      wheel.addEventListener("transitionend", handleTransitionEnd, { once: true });

      function handleTransitionEnd() {
        wheel.style.transition = "none";
        const finalAngle = totalAngle % 360;
        wheel.style.transform = `rotate(${finalAngle}deg)`;

        const wonDiscount = discounts[randomDiscountIndex];
        resultMessage.textContent = `¡Felicidades! Obtuviste un ${wonDiscount}.`;

        // Generar código
        const uniqueCode = generateUniqueCode();
        couponCodeSpan.textContent = uniqueCode;
        codeContainer.style.display = "inline-block";

        isSpinning = false;
      }
    });

    function generateUniqueCode() {
      const characters = "ABCDEFGHIJKLMNOPQRSTUVWXYZ0123456789";
      let code = "DSC-";
      for (let i = 0; i < 6; i++) {
        code += characters.charAt(Math.floor(Math.random() * characters.length));
      }
      return code;
    }

    // Copiar el código al portapapeles
    copyButton.addEventListener("click", () => {
      navigator.clipboard.writeText(couponCodeSpan.textContent).then(() => {
        alert("¡Código copiado al portapapeles!");
      });
    });
  </script>
</body>
</html>
